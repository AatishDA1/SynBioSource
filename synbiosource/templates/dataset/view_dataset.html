{% extends "base.html" %} {% block content %}
<div class="main-content">
  <div class="container mt-5">
    <h1 class="text-center padding">
      {{datasetInfo.metadata_file.basic_identity.title}}, V{{datasetInfo.metadata_file.basic_identity.version}}
    </h1>
    <div class="line"></div>

    <!-- Core Information -->
    <h4 class="text-center font-weight-bold mt-3">
      By {{datasetInfo.owner.full_name}}
    </h4>
    <h5 class="text-center font-weight-bold mt-3">
      {{datasetInfo.created_at}}
    </h5>
    <div class="text-center mb-4">
      <a
        type="button"
        class="btn btn-login mt-3"
        href="/dataset/browse/download/{{datasetInfo.id}}"
      >
        Download <i class="bi bi-download"></i>
      </a>
      <a
        type="button"
        class="btn btn-login mt-3"
        onclick="copyCurrentURL()"
      >
        Share <i class="bi bi-share"></i>
      </a>
      {% if request.user.id == datasetInfo.owner.id or request.user.is_moderator %}
      <a
        type="button"
        class="btn btn-login mt-3"
        href="/dataset/browse/edit/{{datasetInfo.id}}"
      >
        Edit <i class="bi bi-pen"></i>
      </a>
      <a
        type="button"
        class="btn btn-login mt-3"
        href="/dataset/browse/delete/{{datasetInfo.id}}"
      >
        Delete <i class="bi bi-trash"></i>
      </a>
      {% endif %}
    </div>

    <!-- Viewing Section -->
    <div id="dataset-information" class="bg-light p-5 rounded">
      <div data-bs-spy="scroll" data-bs-target="#instructions-navbar" data-bs-smooth-scroll="true" class="uploadInstructions" tabindex="0" style="height: 800px; overflow-y: auto">
        <div class="row">
          <div class="col-4">
            <div id="instructions-navbar" class="nav-pills flex-column sticky-top" style="top: 20px">
              <!-- Basic Info -->
              <a class="nav-link" href="#item-1">Basic Info</a>
              <a class="nav-link ms-3 my-1" href="#item-1-1">Description</a>
              <a class="nav-link ms-3 my-1" href="#item-1-2">Keywords</a>
              <a class="nav-link ms-3 my-1" href="#item-1-3">License</a>
              <a class="nav-link ms-3 my-1" href="#item-1-4">Changelog</a>
              <a class="nav-link ms-3 my-1" href="#item-1-5">Dataset File Structure</a>

              <!-- Author Contact Details -->
              <a class="nav-link" href="#item-2">Author Contact Details</a>
              <a class="nav-link ms-3 my-1" href="#item-2-1">Email</a>
              <a class="nav-link ms-3 my-1" href="#item-2-2">Affiliation</a>
              <a class="nav-link ms-3 my-1" href="#item-2-3">Phone</a>

              <!-- Dataset Creation -->
              <a class="nav-link" href="#item-3">Dataset Creation</a>
              <a class="nav-link ms-3 my-1" href="#item-3-1">General Info</a>
              <a class="nav-link ms-3 my-1" href="#item-3-1-1">Data Origin</a>
              <a class="nav-link ms-3 my-1" href="#item-3-1-2">Synthetic Data Details</a>
              <a class="nav-link ms-3 my-1" href="#item-3-1-3">Natural Data Details</a>
              <a class="nav-link ms-3 my-1" href="#item-3-2">Data Completion</a>
              <a class="nav-link ms-3 my-1" href="#item-3-3">Pre-processing</a>

              <!-- Dataset Usage -->
              <a class="nav-link" href="#item-4">Dataset Usage</a>
              <a class="nav-link ms-3 my-1" href="#item-4-1">Usage Description</a>
              <a class="nav-link ms-3 my-1" href="#item-4-2">Citation</a>
              <a class="nav-link ms-3 my-1" href="#item-4-3">Related Datasets</a>

              <!-- Dataset Composition -->
              <a class="nav-link" href="#item-5">Dataset Composition</a>
              <a class="nav-link ms-3 my-1" href="#item-5-1">General Info</a>
              <a class="nav-link ms-3 my-1" href="#item-5-2">CSV Details</a>
              <a class="nav-link ms-3 my-1" href="#item-5-3">Excel Details</a>

              <!-- Ethics -->
              <a class="nav-link" href="#item-6">Ethics</a>
              <a class="nav-link ms-3 my-1" href="#item-6-1">Data Collection Ethics</a>
              <a class="nav-link ms-3 my-1" href="#item-6-2">Data Usage Ethics</a>
              <a class="nav-link ms-3 my-1" href="#item-6-3">Ethical Review Status</a>
            </div>
          </div>
          <div class="col-8">
            <!-- Basic Info -->
            <h3 id="item-1">Basic Info</h3>
            <h5 id="item-1-1">Description</h5>
            <p>{{ datasetInfo.metadata_file.basic_identity.description }}</p>
            <h5 id="item-1-2">Keywords</h5>
            <p>{{ datasetInfo.metadata_file.basic_identity.keywords }}</p>
            <h5 id="item-1-3">License</h5>
            <p>{{ datasetInfo.metadata_file.basic_identity.license }}</p>
            <h5 id="item-1-4">Changelog</h5>
            <p>{{ datasetInfo.metadata_file.basic_identity.changelog }}</p>
            <h5 id="item-1-5">Dataset File Structure</h5>
            <div id="folderStructure" class="bg-light rounded"></div>

            <!-- Author Contact Details -->
            <h3 id="item-2">Author Contact Details</h3>
            <h5 id="item-2-1">Email</h5>
            <p>{{ datasetInfo.metadata_file.author_contact_details.email }}</p>
            <h5 id="item-2-2">Affiliation</h5>
            <p>{{ datasetInfo.metadata_file.author_contact_details.affiliation }}</p>
            <h5 id="item-2-3">Phone</h5>
            <p>{{ datasetInfo.metadata_file.author_contact_details.phone }}</p>

            <!-- Dataset Creation -->
            <h3 id="item-3">Dataset Creation</h3>
            <h4 id="item-3-1">General Info</h4>
            <h5 id="item-3-1-1">Data Origin</h5>
            <p>{{ datasetInfo.metadata_file.dataset_creation.general.data_origin }}</p>
            <h5 id="item-3-1-2">Synthetic Data Details</h5>
            <p>{{ datasetInfo.metadata_file.dataset_creation.general.synthetic_data_details.generation_method }}</p>
            <h5 id="item-3-1-3">Natural Data Details</h5>
            <p>{{ datasetInfo.metadata_file.dataset_creation.general.natural_data_details.collection_circumstances }}</p>
            <h4 id="item-3-2">Data Completion</h4>
            <p>{{ datasetInfo.metadata_file.dataset_creation.data_completion.dataset_status }}</p>
            <h4 id="item-3-3">Pre-processing</h4>
            <p>{{ datasetInfo.metadata_file.dataset_creation.pre_processing.data_cleanliness.cleanliness_status }}</p>

            <!-- Dataset Usage -->
            <h3 id="item-4">Dataset Usage</h3>
            <h5 id="item-4-1">Usage Description</h5>
            <p>{{ datasetInfo.metadata_file.dataset_usage.data_usage_description }}</p>
            <h5 id="item-4-2">Citation</h5>
            <p>{{ datasetInfo.metadata_file.dataset_usage.citation }}</p>
            <h5 id="item-4-3">Related Datasets</h5>
            <p>{{ datasetInfo.metadata_file.dataset_usage.related_datasets }}</p>

            <!-- Dataset Composition -->
            <h3 id="item-5">Dataset Composition</h3>
            <h4 id="item-5-1">General Info</h4>
            <p>{{ datasetInfo.metadata_file.dataset_composition.general.format }}</p>
            <h5 id="item-5-2">CSV Details</h5>
            <p>{{ datasetInfo.metadata_file.dataset_composition.csv.delimiter }}</p>
            <h5 id="item-5-3">Excel Details</h5>
            <p>{{ datasetInfo.metadata_file.dataset_composition.excel.has_macros }}</p>

            <!-- Ethics -->
            <h3 id="item-6">Ethics</h3>
            <h5 id="item-6-1">Data Collection Ethics</h5>
            <p>{{ datasetInfo.metadata_file.ethics.data_collection_ethics }}</p>
            <h5 id="item-6-2">Data Usage Ethics</h5>
            <p>{{ datasetInfo.metadata_file.ethics.data_usage_ethics }}</p>
            <h5 id="item-6-3">Ethical Review Status</h5>
            <p>{{ datasetInfo.metadata_file.ethics.ethical_review_status }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- File Tree Script -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var folderJson = {{ datasetInfo.metadata_file.folder_structure|safe }};

    function buildTree(paths) {
      let tree = {};
      paths.forEach((path) => {
        path = path.split('/');
        let current = tree;
        for (let part of path) {
          if (!current[part]) {
            current[part] = {}; // Creates a nested object if it doesn't exist.
          }
          current = current[part]; // Goes down the tree.
        }
      });
      return tree;
    }

    function createTreeDom(node, path = '') {
      let ul = document.createElement('ul');
      for (let key in node) {
        let li = document.createElement('li');
        li.textContent = key;
        let fullPath = path + key + '/';
        li.setAttribute('title', fullPath); // Tooltip showing the full path.
        if (Object.keys(node[key]).length > 0) {
          li.appendChild(createTreeDom(node[key], fullPath)); // Recursively add child lists.
        }
        ul.appendChild(li);
      }
      return ul;
    }

    var paths = Object.values(folderJson);
    var tree = buildTree(paths);
    var treeDom = createTreeDom(tree);
    document.getElementById("folderStructure").appendChild(treeDom);
  });
</script>

<!-- Share Link Script -->
<script>
  function copyCurrentURL() {
  const url = window.location.href; // Gets the current URL.
  navigator.clipboard.writeText(url).then(() => {
    alert('URL copied to clipboard!');
  }).catch(err => {
    console.error('Error in copying URL: ', err);
  });
}
</script>
{% endblock %}
